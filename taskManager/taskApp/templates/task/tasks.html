{% extends 'main.html' %}

{% block title %}Task List{% endblock %}

{% block content %}
    <form class="filter-form" method="get" action="{% url 'task_list' %}">
        <label class="filter-label" for="filter-date">Filter by Date:</label>
        <input class="filter-input" type="date" id="filter-date" name="date">
        <button class="filter-btn" type="submit">Filter</button>
    </form>
    <h1>Task List</h1>
    <ul id="task-list">
        {% for task in task_list %}
            <li class="task-card">
                <div class="task-info">
                    <div class="task-title">{{ task.title }}</div>
                    <div>
                        <input type="checkbox" class="checkbox-input" onchange="toggleTaskDone({{ task.id }})"
                               {% if task.done %}checked{% endif %}>
                    </div>
                    <div class="task-date">Created at: {{ task.date }}</div>
                </div>
                <div class="action-buttons">
                    <button class="edit-btn" onclick="window.location.href='{% url 'edit_task' task.id %}'">Edit
                    </button>
                    <form id="delete-form-{{ task.id }}" action="{% url 'delete_task' task.id %}" method="post"
                          style="display: inline;">
                        {% csrf_token %}
                        <button class="delete-btn" type="submit"
                                onclick="return confirm('Are you sure you want to delete this task?')">Delete
                        </button>
                    </form>
                </div>

            </li>
        {% endfor %}
    </ul>

    <script>
        function toggleTaskDone(taskId) {
            fetch(`/task/done/${taskId}/`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}'
                }
            }).catch(error => {
                console.error('Error toggling task done status:', error);
            });
        }
    </script>
{% endblock %}
